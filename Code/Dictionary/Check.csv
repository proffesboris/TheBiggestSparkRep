CHECK_NUM;CHECK_NAME;CHECK_BASE_CD;CHECK_CODE;CHECK_DEPENDENCE_CD;CHECK_BASE_DESC;CHECK_ANALYST_NAME;CHECK_LVL;CHECK_TGT_TABLE;CHECK_SQL_TEXT;CHECK_SQL_TEXT_UAT
;Проверка на наличие бенефициара - ФЛ;Заемщик (ЮЛ);BEN_EXIST;;CLU{FLAG_BASIS_CLIENT = 'Y'};Спирин Артем;1;SCORE_CHECK;select a.u7m_id,'BEN_EXIST' as check_name,2 as check_lvl,1 as check_flg from {{schema_k7m_pa}}.clu a where a.flag_basis_client = 'Y' and not exists ( select 1 from {{schema_k7m_pa}}.lk b join {{schema_k7m_pa}}.lkc c on (b.lk_id = c.lk_id and c.crit_id in ('ben_crm')) join {{schema_k7m_pa}}.clf d on (d.f7m_id = b.u7m_id_from) where b.u7m_id_to = a.u7m_id and b.t_to = 'CLU' and b.t_from = 'CLF' and d.s_name is not null and d.f_name is not null and (d.b_date is not null or (d.id_series is not null and d.id_num is not null) or d.inn is not null));
;Проверка заемщика на наличие ЕИО;Заемщик (ЮЛ);EIO_EXIST;;;Ключко Павел;1;SCORE_CHECK;select c.u7m_id,'EIO_EXIST' as check_name,1 as check_lvl,1 as check_flg from {{schema_k7m_pa}}.clu c left join ( select lk.u7m_id_to, lk.lk_id from {{schema_k7m_pa}}.lk join {{schema_k7m_pa}}.lkc on lk.lk_id = lkc.lk_id and lkc.crit_id = 'EIOGEN_EKS' ) x on c.u7m_id = x.u7m_id_to where c.flag_basis_client = 'Y' and x.lk_id is null;
24;Картотека счета и арест/блокировка счета (возможны по требованию Налоговой службы, ФССП или по решению суда);Заемщик (ЮЛ) Поручители (ЮЛ, ИП);CARTT;;CLU;Постнова Мария;1;CLU_CHECK;select clu.u7m_id, 'CARTT', 1 as check_lvl, chk.cartt_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_010 chk on clu.eks_id = cast(chk.eks_id as string) ; select clu.u7m_id, 'CARTT', 1 as check_lvl, chk.cartt_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_010 chk on clu.eks_id = cast(chk.eks_id as string)
22;Рейтинги;Заемщик (ЮЛ);RATING;;CLU{FLAG_BASIS_CLIENT = 'Y'};Спирин Артем;1;SCORE_CHECK;SELECT a.U7M_ID, 'RATING' as check_name, 1 as check_lvl, CASE WHEN a.RATING_MAIN_PROCESS_OFFLINE > 18 AND ADD_MONTHS(a.RATING_APPR_DT_OFFLINE, 6) >= coalesce(etl.run_dt, cast(current_date as timestamp)) THEN 1 ELSE 0 END as check_flg from {{schema_k7m_pa}}.clu a cross join ( SELECT MAX(run_dt) as run_dt FROM ( Select run_dt, status, row_number() over (partition by exec_id order by insert_dt desc) rn from {{schema_k7m_aux}}.etl_exec_stts) x where rn = 1 and status = 'RUNNING') etl where a.flag_basis_client = 'Y';
КОД;ФИО ЕИО Заёмщика и Поручителя;Заемщик (ЮЛ) Поручители (ЮЛ);COD_EIO_NAME;;CLU, CLF;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_EIO_NAME' as check_name,1 as check_lvl ,case when name_eio rlike '^[А-ЯЁа-яё /\"]+$' then 0  when length(s_name) < 3 then 1  when length(f_name) < 2 then 1  when length(l_name) < 2 then 1  else 1 end as check_flg from (select clu.u7m_id, clu.crm_id, clu.flag_basis_client, clf_eio.f_name, clf_eio.s_name, clf_eio.l_name,  concat(clf_eio.f_name, clf_eio.s_name, clf_eio.l_name) AS name_eio FROM {{schema_k7m_pa}}.clu clu JOIN {{schema_k7m_pa}}.lk lk_eio ON clu.u7m_id = lk_eio.u7m_id_to and lk_eio.t_to = 'CLU' and lk_eio.t_from = 'CLF' JOIN {{schema_k7m_pa}}.clf clf_eio ON lk_eio.u7m_id_from = clf_eio.f7m_id JOIN {{schema_k7m_pa}}.lkc lkc_eio ON lk_eio.lk_id = lkc_eio.lk_id and upper(lkc_eio.crit_id) IN ( 'EIOGEN', 'EIOGEN_EKS')) CLU;
КОД;Должность ЕИО Заёмщика и Поручителя;Заемщик (ЮЛ) Поручители (ЮЛ);COD_EIO_POSITION;;CLU, CLF;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_EIO_POSITION' as check_name,1 as check_lvl,case when Position_eio rlike '^[А-ЯЁа-яё /\"]+$' then 0 else 1 end as check_flg from (select clu.u7m_id,clu.crm_id,clu.flag_basis_client, clf_eio.Position_eio FROM {{schema_k7m_pa}}.clu clu JOIN {{schema_k7m_pa}}.lk lk_eio ON clu.u7m_id = lk_eio.u7m_id_to and lk_eio.t_to = 'CLU' and lk_eio.t_from = 'CLF' JOIN {{schema_k7m_pa}}.clf clf_eio ON lk_eio.u7m_id_from = clf_eio.f7m_id JOIN {{schema_k7m_pa}}.lkc lkc_eio ON lk_eio.lk_id = lkc_eio.lk_id and upper(lkc_eio.crit_id) IN ('EIOGEN','EIOGEN_EKS')) CLU ; select CLU.u7m_id,'COD_EIO_POSITION' as check_name,1 as check_lvl, case when Position_eio rlike '^[А-ЯЁа-яё /\"]+$' then 0 else 1 end as check_flg from (select clu.u7m_id, clu.crm_id, clu.flag_basis_client, clf_eio.Position_eio FROM {{schema_k7m_pa}}.clu clu JOIN {{schema_k7m_pa}}.lk lk_eio ON clu.u7m_id = lk_eio.u7m_id_to and lk_eio.t_to = 'CLU' and lk_eio.t_from = 'CLF' JOIN {{schema_k7m_pa}}.clf clf_eio ON lk_eio.u7m_id_from = clf_eio.f7m_id JOIN {{schema_k7m_pa}}.lkc lkc_eio ON lk_eio.lk_id = lkc_eio.lk_id and upper(lkc_eio.crit_id) IN ( 'EIOGEN', 'EIOGEN_EKS')) CLU
КОД;Имя Поручителя ФЛ;Заемщик (ЮЛ) Поручители (ЮЛ);COD_F_NAME;;CLF;Амелин Сергей;1;CLF_CHECK;select CLF.f7m_id , 'COD_F_NAME' as check_name, 1 as check_lvl, case when clf.f_name rlike '^[А-ЯЁа-яё ]+$' and length(clf.f_name) > 1 then 0 else 1 end as check_flg from {{schema_k7m_pa}}.clf ;select CLF.f7m_id , 'COD_F_NAME' as check_name, 1 as check_lvl, case when clf.f_name rlike '^[А-ЯЁа-яё ]+$' and length(clf.f_name) > 1 then 0 else 1 end as check_flg from {{schema_k7m_pa}}.clf
КОД;Полное наименование Заемщика;Заемщик (ЮЛ) Поручители (ЮЛ);COD_FULL_NAME;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id ,'COD_FULL_NAME' as check_name,1 as check_lvl,case when CLU.full_name = '' or CLU.full_name rlike '^[А-ЯЁа-яё0-9 /\"-]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;select CLU.u7m_id ,'COD_FULL_NAME' as check_name,1 as check_lvl,case when CLU.full_name = '' or CLU.full_name rlike '^[А-ЯЁа-яё0-9 /\"-]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU
КОД;Номер Поручителя ФЛ;Заемщик (ЮЛ) Поручители (ЮЛ);COD_ID_NUM;;CLF;Амелин Сергей;1;CLF_CHECK; select CLF.f7m_id,'COD_ID_NUM' as check_name ,1 as check_lvl ,case when clf.ID_NUM rlike '^[0-9]+$' and length(clf.ID_NUM) = 6 then 0 else 1 end as check_flg from {{schema_k7m_pa}}.clf;
КОД;Серия Поручителя ФЛ;Заемщик (ЮЛ) Поручители (ЮЛ);COD_ID_SERIES;;CLF;Амелин Сергей;1;CLF_CHECK; select CLF.f7m_id ,'COD_ID_SERIES' as check_name ,1 as check_lvl ,case when clf.ID_SERIES rlike '[0-9][0-9][ ][0-9][0-9]' or clf.ID_SERIES rlike '[0-9][0-9][0-9][0-9]' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.clf;
КОД;Кем выдан Поручителя ФЛ;Заемщик (ЮЛ) Поручители (ЮЛ);COD_ID_SOURCE;;CLF;Амелин Сергей;1;CLF_CHECK;select CLF.f7m_id ,'COD_ID_SOURCE' as check_name ,1 as check_lvl ,case when clf.ID_SOURCE rlike '^[А-ЯЁа-яё0-9 /\"]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.clf ;select CLF.f7m_id ,'COD_ID_SOURCE' as check_name ,1 as check_lvl ,case when clf.ID_SOURCE rlike '^[А-ЯЁа-яё0-9 /\"]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.clf
КОД;ИНН Поручителя-юридического лица;Заемщик (ЮЛ) Поручители (ЮЛ);COD_INN;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id ,'COD_INN' as check_name ,1 as check_lvl ,case when ((2* substr(clu.inn,1,1) + 4*substr(inn,2,1) + 10*substr(inn,3,1) + 3*substr(inn,4,1) + 5*substr(inn,5,1) + 9*substr(inn,6,1) + 4*substr(inn,7,1) + 6*substr(inn,8,1) + 8*substr(inn,9,1)) %11 ) %10 <> substr(inn,10,1) and length(inn) =  10 then 1 when length(inn) = 12 and inn not rlike '^[0-9]+$' then 1 when inn = '111111111111' then 1 else 0 end as check_flg from {{schema_k7m_pa}}.CLU ; select CLU.u7m_id ,'COD_INN' as check_name ,1 as check_lvl ,case when ((2* substr(clu.inn,1,1) + 4*substr(inn,2,1) + 10*substr(inn,3,1) + 3*substr(inn,4,1) + 5*substr(inn,5,1) + 9*substr(inn,6,1) + 4*substr(inn,7,1) + 6*substr(inn,8,1) + 8*substr(inn,9,1)) %11 ) %10 <> substr(inn,10,1) then 1 when length(inn) = 12 and inn not rlike '^[0-9]+$' then 1 when inn = '111111111111' then 1 else 0 end as check_flg from {{schema_k7m_pa}}.CLU
КОД;КПП Поручителя-юридического лица;Заемщик (ЮЛ) Поручители (ЮЛ);COD_KPP;;CLU;Амелин Сергей;1;CLU_CHECK; select CLU.u7m_id ,'COD_KPP' as check_name ,1 as check_lvl ,case when (CLU.KPP rlike '^[0-9]+$') and length(CLU.KPP) = 9 then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU ; select CLU.u7m_id ,'COD_KPP' as check_name ,1 as check_lvl ,case when (CLU.KPP rlike '^[0-9]+$') and length(CLU.KPP) = 9 then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU
КОД;Фамилия Поручителя ФЛ;Заемщик (ЮЛ) Поручители (ЮЛ);COD_L_NAME;;CLF;Амелин Сергей;1;CLF_CHECK; select CLF.f7m_id, 'COD_L_NAME' as check_name ,1 as check_lvl ,case when clf.l_name rlike '^[А-ЯЁа-яё ]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.clf ; select CLF.f7m_id, 'COD_L_NAME' as check_name ,1 as check_lvl ,case when clf.l_name rlike '^[А-ЯЁа-яё ]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.clf
КОД;ОГРН Поручителя-юридического лица;Заемщик (ЮЛ) Поручители (ЮЛ);COD_OGRN;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id ,'COD_OGRN' as check_name ,1 as check_lvl, case when length(clu.ogrn) = 13 and (cast(substr(clu.ogrn,1,12) as double) % 11 ) %10 = (substr(clu.ogrn,13,1)) then 0  when length(clu.ogrn) = 15 and (cast(substr(clu.ogrn,1,14) as double) % 13 ) %10 = (substr(clu.ogrn,15,1)) then 0  else 1 end as check_flg from {{schema_k7m_pa}}.CLU -- Контрольная цифра равна остатку от деления на 11 числа, состоящего из первых 12 цифр ОГРН. Если остаток больше 9, то n1 = последней цифре остатка. ; select CLU.u7m_id ,'COD_OGRN' as check_name ,1 as check_lvl,case when length(clu.ogrn) = 13 and (cast(substr(clu.ogrn,1,12) as double) % 11 ) %10 = (substr(clu.ogrn,13,1)) then 0  when length(clu.ogrn) = 15 and (cast(substr(clu.ogrn,1,14) as double) % 13 ) %10 = (substr(clu.ogrn,15,1)) then 0  else 1 end as check_flg from {{schema_k7m_pa}}.CLU -- Контрольная цифра равна остатку от деления на 11 числа, состоящего из первых 12 цифр ОГРН. Если остаток больше 9, то n1 = последней цифре остатка.
КОД;Организационно правовая форма Заемщика;Заемщик (ЮЛ) Поручители (ЮЛ);COD_OPF;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id ,'COD_OPF' as check_name ,1 as check_lvl ,case when CLU.OPF rlike '^[0-9]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU ;select CLU.u7m_id ,'COD_OPF' as check_name ,1 as check_lvl ,case when CLU.OPF rlike '^[0-9]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU
КОД;Отчество Поручителя ФЛ;Заемщик (ЮЛ) Поручители (ЮЛ);COD_S_NAME;;CLF;Амелин Сергей;1;CLF_CHECK;select CLF.f7m_id,'COD_S_NAME' as check_name ,1 as check_lvl ,case when clf.s_name rlike '^[А-Я а-я]+$' and length(clf.s_name) > 1 then 0 else 1 end as check_flg from {{schema_k7m_pa}}.clf;select CLF.f7m_id,'COD_S_NAME' as check_name ,1 as check_lvl ,case when clf.s_name rlike '^[А-Я а-я]+$' and length(clf.s_name) > 1 then 0 else 1 end as check_flg from {{schema_k7m_pa}}.clf
КОД;Номер договора ДБО (только для ЮЛ – Клиентов СББОЛ).;Заемщик (ЮЛ) Поручители (ЮЛ);COD_SBBOL_NDOG;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id ,'COD_SBBOL_NDOG' as check_name ,1 as check_lvl ,case when CLU.SBBOL_NDOG rlike '^[/0-9]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU ; select CLU.u7m_id ,'COD_SBBOL_NDOG' as check_name ,1 as check_lvl ,case when CLU.SBBOL_NDOG rlike '^[/0-9]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU
КОД;Краткое наименование Заемщика;Заемщик (ЮЛ) Поручители (ЮЛ);COD_SHORT_NAME;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id ,'COD_SHORT_NAME' as check_name ,1 as check_lvl ,case when CLU.SHORT_NAME rlike '^[А-ЯЁа-яё0-9 /\"-]' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;select CLU.u7m_id ,'COD_SHORT_NAME' as check_name ,1 as check_lvl ,case when CLU.SHORT_NAME rlike '[А-ЯЁа-яё0-9 /\"-]' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU
29;Страна ведения основной деятельности контрагента;Заемщик (ЮЛ);COUNTR;;CLU{FLAG_BASIS_CLIENT = 'Y'};Кузнецов Максим;2;CLU_CHECK;select clu.u7m_id, 'COUNTR' as check_name, 2 as check_lvl, cc.flag_countr as check_flg from  {{schema_k7m_pa}}.clu join {{schema_k7m_aux}}.check_countr cc on cc.crm_id = clu.crm_id where clu.flag_basis_client = 'Y';select clu.u7m_id, 'COUNTR' as check_name, 1 as check_lvl, cc.flag_countr as check_flg from  {{schema_k7m_pa}}.clu join {{schema_k7m_aux}}.check_countr cc on cc.crm_id = clu.crm_id where clu.flag_basis_client = 'Y';
8;Адрес регистрации, место фактического нахождения и наличие связей с Республикой Крым и городом Севастополь;Заемщик (ЮЛ);CRIMEA_CRM;;CLU{FLAG_BASIS_CLIENT = 'Y'};Постнова Мария;1;SCORE_CHECK;select clu.u7m_id, 'CRIMEA_CRM', 1 as check_lvl, chk.crimea_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_039 chk on clu.crm_id = chk.crm_id where flag_basis_client = 'Y' ; select clu.u7m_id, 'CRIMEA_CRM', 1 as check_lvl, chk.crimea_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_039 chk on clu.crm_id = chk.crm_id where flag_basis_client = 'Y'
8;Адрес регистрации, место фактического нахождения и наличие связей с Республикой Крым и городом Севастополь;Заемщик (ЮЛ);CRIMEA_EKS;;CLU{FLAG_BASIS_CLIENT = 'Y'};Постнова Мария;1;SCORE_CHECK;select clu.u7m_id, 'CRIMEA_EKS', 1 as check_lvl, chk.crimea_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_010 chk on clu.eks_id = cast(chk.eks_id as string) where flag_basis_client = 'Y' ; select clu.u7m_id, 'CRIMEA_EKS', 1 as check_lvl, chk.crimea_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_010 chk on clu.eks_id = cast(chk.eks_id as string) where flag_basis_client = 'Y'
32;Проверка контрагента на предмет наличия у него выданных поручительств по кредитным обязательствам, по которым имеется просроченная задолженность (проверка наличия просроченной задолженности по договорам поручительства);Заемщик (ЮЛ) Поручители (ЮЛ, ИП, ФЛ);DPDSU;;CLU;Постнова Мария;1;CLU_CHECK;select clu.u7m_id, 'DPDSU', 1 as check_lvl, case when t.c_inn is not null then 1 when t.c_inn is null then 0 end as check_flg from  {{schema_k7m_pa}}.clu clu left join (select distinct cl.c_inn from  {{schema_k7m_aux}}.k7m_cred_bal c inner join   {{schema_k7m_aux}}.k7m_zalog_dispensed z on c.cred_id = z.cred_id inner join  {{schema_k7m_stg}}.eks_z_client cl on cl.id = zalog_client_id where z.zalog_acc like '91414%' and c_name_account in (1189819973, 2049610)) t on clu.inn = t.c_inn;
33;Проверка соответствия данных по контрагенту в ЕКС и Роботе-юристе;Заемщик (ЮЛ) Поручители (ЮЛ);EKS2RLWOFF;;CLU;Амелин Сергей;1;CLU_CHECK;select clu.u7m_id, 'EKS2RLWOFF', 1 as check_lvl, case when (ru_ogrn <> ogrn or ru_kpp <> kpp or lower(regexp_replace(ru_full_name, ' ', '')) <> lower(regexp_replace(full_name, ' ', '')) or lower(regexp_replace(ru_short_name, ' ', '')) <> lower(regexp_replace(short_name, ' ', ''))) then 1 else 0 end as check_flg from  {{schema_k7m_pa}}.clu where flag_basis_client = 'Y';
9;Наличие у заемщика принятых на обслуживание в Банке внешнеторговых контрактов с контрагентами из юрисдикций высокого комплаенс-риска;Заемщик (ЮЛ);EXTC;;CLU{FLAG_BASIS_CLIENT = 'Y'};Амелин Сергей;1;SCORE_CHECK;select clu_flag.u7m_id ,'EXTC' as check_name ,1 as check_lvl ,max(clu_flag.FLAG_COUNTRY_COMPLIANCE) from ( select clu.u7m_id ,clu.crm_id ,case when cc.code is null then 0 else 1 end as FLAG_COUNTRY_COMPLIANCE FROM {{schema_k7m_pa}}.clu left join {{schema_k7m_stg}}.eks_z_psd PSD on substr(psd.C_P_1_5_INN_KPP,1,10) = clu.inn left join {{schema_k7m_stg}}.eks_Z_PS_RECV_N PS on PSD.C_NOTREZIDENT = PS.COLLECTION_ID left join {{schema_k7m_stg}}.eks_z_country C on PS.C_COUNTRY = C.ID left join internal_rdm.rdm_ctry_compl_k7m_mast_v CC on C.C_ALFA_2 = CC.code WHERE psd.C_P_1_5_INN_KPP is not null and clu.flag_basis_client = 'Y' ) clu_flag where FLAG_COUNTRY_COMPLIANCE = 1 group by clu_flag.u7m_id;
30;Совместные клиенты на уровне Группы Сбербанка;Заемщик (ЮЛ);GRCL;;CLU{FLAG_BASIS_CLIENT = 'Y'};Кузнецов Максим;1;SCORE_CHECK;select clu.u7m_id, 'GRCL', 1 as check_lvl, case when r.crm_id is not null then 1 when r.crm_id is null then 0 end as check_flg from {{schema_k7m_pa}}.clu clu left join internal_rdm.rdm_collab_list_k7m_mast_v r on clu.crm_id = r.crm_id where clu.flag_basis_client = 'Y';select clu.u7m_id, 'GRCL', 1 as check_lvl, case when r.crm_id is not null then 1 when r.crm_id is null then 0 end as check_flg from {{schema_k7m_pa}}.clu clu left join internal_rdm.rdm_collab_list_k7m_mast_v r on clu.crm_id = r.crm_id where clu.flag_basis_client = 'Y'
10;Проверка в составе данных о клиенте (потенциальном заемщике), а также в составе информации о заключенных ранее с заемщиком сделок, указаний на юрисдикции высокого комплаенс-риска;Заемщик (ЮЛ);HJR;;CLU{FLAG_BASIS_CLIENT = 'Y'};Постнова Мария;1;SCORE_CHECK;select clu.u7m_id, 'HJR', 1 as check_lvl, chk.hjr_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_010 chk on clu.eks_id = cast(chk.eks_id as string) where flag_basis_client = 'Y' ; select clu.u7m_id, 'HJR', 1 as check_lvl, chk.hjr_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_010 chk on clu.eks_id = cast(chk.eks_id as string) where flag_basis_client = 'Y'
28;Внутренняя кредитная история по юридическим и физическим лицам;Заемщик (ЮЛ) Поручители (ЮЛ, ИП);INTCRH;;CLU;Постнова Мария;1;CLU_CHECK; select clu.u7m_id, 'INTRH', 1 as check_lvl, chk.intcrh_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_010 chk on clu.eks_id = cast(chk.eks_id as string) ; select clu.u7m_id, 'INTRH', 1 as check_lvl, chk.intcrh_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_010 chk on clu.eks_id = cast(chk.eks_id as string)
34;Ограничение по категории качества ссуды;Заемщик (ЮЛ);KKSOFF;;CLU;Постнова Мария;1;SCORE_CHECK; select clu.u7m_id, 'KKSOF', 1 as check_lvl, chk.kksoff_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_010 chk on clu.eks_id = cast(chk.eks_id as string) ; select clu.u7m_id, 'KKSOF', 1 as check_lvl, chk.kksoff_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_010 chk on clu.eks_id = cast(chk.eks_id as string)
;Проверка терр.подразделения КМ;Заемщик (ЮЛ);KMTERR;;CLU{FLAG_BASIS_CLIENT = 'Y'};Постнова Мария;1;SCORE_CHECK;select clu.u7m_id, 'KMTERR', 1 as check_lvl, case when vko.org_crm_id is null  then 1  when vko.org_crm_id is not null then 0 else -1  end as check_flg FROM  {{schema_k7m_pa}}.clu clu left JOIN {{schema_k7m_aux}}.k7m_vko vko ON vko.org_crm_id = clu.crm_id  where flag_basis_client = 'Y';select clu.u7m_id, 'KMTERR', 1 as check_lvl, case when vko.org_crm_id is null  then 1  when vko.org_crm_id is not null then 0 else -1  end as check_flg FROM  {{schema_k7m_pa}}.clu clu left JOIN {{schema_k7m_aux}}.k7m_vko vko ON vko.org_crm_id = clu.crm_id  where flag_basis_client = 'Y'
16;Отсечение крупных ГСЗ;Заемщик (ЮЛ);LGSZ;;CLU{FLAG_BASIS_CLIENT = 'Y'};Спирин Артем;1;SCORE_CHECK; SELECT a.U7M_ID, 'LGSZ' as check_name, 1 as check_lvl, CASE WHEN d1_1.code is not null or d1_2.code is not null or d1_3.code is not null or d1_4.code is not null THEN 1 ELSE 0 END as check_flg from {{schema_k7m_pa}}.clu a LEFT JOIN {{schema_k7m_stg}}.crm_cx_gsz a1_1 ON (a1_1.row_id = a.crm_gsz_id and a1_1.status <> 'Закрыта') LEFT JOIN internal_rdm.rdm_major_gsz_k7m_mast_v d1_1 on (d1_1.code = a1_1.row_id) LEFT JOIN {{schema_k7m_stg}}.crm_cx_gsz a1_2 ON (a1_1.parent_gsz_id = a1_2.row_id and a1_2.status <> 'Закрыта') LEFT JOIN internal_rdm.rdm_major_gsz_k7m_mast_v d1_2 on (d1_2.code = a1_2.row_id) LEFT JOIN {{schema_k7m_stg}}.crm_cx_gsz a1_3 ON (a1_2.parent_gsz_id = a1_3.row_id and a1_3.status <> 'Закрыта') LEFT JOIN internal_rdm.rdm_major_gsz_k7m_mast_v d1_3 on (d1_3.code = a1_3.row_id) LEFT JOIN {{schema_k7m_stg}}.crm_cx_gsz a1_4 ON (a1_3.parent_gsz_id = a1_4.row_id and a1_4.status <> 'Закрыта') LEFT JOIN internal_rdm.rdm_major_gsz_k7m_mast_v d1_4 on (d1_4.code = a1_4.row_id) where a.flag_basis_client = 'Y'; SELECT a.U7M_ID, 'LGSZ' as check_name, 1 as check_lvl, CASE WHEN d1_1.code is not null or d1_2.code is not null or d1_3.code is not null or d1_4.code is not null THEN 1 ELSE 0 END as check_flg from {{schema_k7m_pa}}.clu a LEFT JOIN {{schema_k7m_stg}}.crm_cx_gsz a1_1 ON (a1_1.row_id = a.crm_gsz_id and a1_1.status <> 'Закрыта') LEFT JOIN internal_rdm.rdm_major_gsz_k7m_mast_v d1_1 on (d1_1.code = a1_1.row_id) LEFT JOIN {{schema_k7m_stg}}.crm_cx_gsz a1_2 ON (a1_1.parent_gsz_id = a1_2.row_id and a1_2.status <> 'Закрыта') LEFT JOIN internal_rdm.rdm_major_gsz_k7m_mast_v d1_2 on (d1_2.code = a1_2.row_id) LEFT JOIN {{schema_k7m_stg}}.crm_cx_gsz a1_3 ON (a1_2.parent_gsz_id = a1_3.row_id and a1_3.status <> 'Закрыта') LEFT JOIN internal_rdm.rdm_major_gsz_k7m_mast_v d1_3 on (d1_3.code = a1_3.row_id) LEFT JOIN {{schema_k7m_stg}}.crm_cx_gsz a1_4 ON (a1_3.parent_gsz_id = a1_4.row_id and a1_4.status <> 'Закрыта') LEFT JOIN internal_rdm.rdm_major_gsz_k7m_mast_v d1_4 on (d1_4.code = a1_4.row_id) where a.flag_basis_client = 'Y'
26;Отрицательные чистые активы контрагента;Заемщик (ЮЛ);NCA;;CLU{FLAG_BASIS_CLIENT = 'Y'};Спирин Артем;1;SCORE_CHECK;select clu.u7m_id,'NCA' as check_name, 1 as check_lvl, 1 as check_flg from {{schema_k7m_pa}}.clu clu left join ( select a.crm_cust_id, a.fin_stmt_rep_dt,a.fin_stmt_1300_amt as amt from {{schema_k7m_aux}}.fok_fin_stmt_rsbu a join ( select crm_cust_id, max(fin_stmt_rep_dt) as fin_stmt_rep_dt from {{schema_k7m_aux}}.fok_fin_stmt_rsbu group by crm_cust_id) b on a.crm_cust_id = b.crm_cust_id and a.fin_stmt_rep_dt = b.fin_stmt_rep_dt) fok on (clu.crm_id = fok.crm_cust_id) left join ( select a.cust_inn_num, a.fin_stmt_rep_dt,a.fin_stmt_1300_amt as amt from {{schema_k7m_aux}}.int_fin_stmt_rsbu a join ( select cust_inn_num, max(fin_stmt_rep_dt) as fin_stmt_rep_dt from {{schema_k7m_aux}}.int_fin_stmt_rsbu group by cust_inn_num) b on a.cust_inn_num = b.cust_inn_num and a.fin_stmt_rep_dt = b.fin_stmt_rep_dt) intg on (clu.inn = intg.cust_inn_num) where clu.flag_basis_client = 'Y' and (fok.crm_cust_id is not null or intg.cust_inn_num is not null) and case when coalesce(intg.fin_stmt_rep_dt, cast('1900-01-01 00:00:00' as timestamp)) > coalesce(fok.fin_stmt_rep_dt, cast('1900-01-01 00:00:00' as timestamp)) then intg.amt else fok.amt end < 0;
19;Проверка на предмет наличия новых запрошенных продуктов, которые могут повлиять на риск-сегмент контрагента;Заемщик (ЮЛ);NPR;;CLU{FLAG_BASIS_CLIENT = 'Y'};Постнова Мария;1;SCORE_CHECK;select clu.u7m_id, 'NPR', 1 as check_lvl, chk.npr_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_039 chk on clu.crm_id = chk.crm_id ; select clu.u7m_id, 'NPR', 1 as check_lvl, chk.npr_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_039 chk on clu.crm_id = chk.crm_id
14;Проверка критериев проблемности по кредитующимся контрагентам;Заемщик (ЮЛ) Поручители (ЮЛ, ИП);PRCR;;CLU;Спирин Артем;1;CLU_CHECK;select a.u7m_id, 'PRCR' as check_name, 1 as check_lvl, 1 as check_flg from {{schema_k7m_pa}}.clu a join {{schema_k7m_stg}}.CRM_CX_MONITORING cm on cm.account_id = a.crm_id and cm.this_is_active = 'Y' join {{schema_k7m_stg}}.CRM_CX_MON_CRIT cmc on cmc.MON_ID = cm.row_id  and cmc.STATUS not in ('Отклонен','Архив') join {{schema_k7m_stg}}.CRM_CX_MON_CRIT_ADM cm_adm on cmc.CRIT_ID = cm_adm.row_id join ( select distinct o.OU_ID from {{schema_k7m_stg}}.CRM_S_OPTY opt join {{schema_k7m_stg}}.CRM_CX_AGREE_OPTY ao on (opt.row_id = ao.opty_id) join {{schema_k7m_stg}}.CRM_S_REVN rr on (rr.opty_id = opt.row_id and lower(rr.REVN_STAT_CD) in ('действующий','в процессе изменения')) join {{schema_k7m_stg}}.CRM_S_OPTYPRD_ORG o on (o.OPTY_PRD_ID = rr.row_id) ) o on o.OU_ID = a.crm_id join ( select distinct c.c_inn from {{schema_k7m_stg}}.EKS_Z_CLIENT c join ( select id, c_client from {{schema_k7m_stg}}.EKS_Z_PR_CRED union all select id, c_principal as c_client from {{schema_k7m_stg}}.EKS_Z_GUARANTIES union all select id, c_client from {{schema_k7m_stg}}.EKS_Z_GEN_AGREEM_FRAME union all select id, c_client from internal_eks_ibs.Z_FACTORING union all select id, C_USER_ZALOG as c_client from {{schema_k7m_stg}}.EKS_Z_ZALOG ) op on op.c_client = c.id join {{schema_k7m_stg}}.EKS_Z_PRODUCT pr on (op.id = pr.id and pr.c_date_close is not null) where c.c_inn is not null ) eks_pr on (a.inn = eks_pr.c_inn) where cm_adm.probl_group in ('Красная зона', 'Черная зона') or (cm_adm.probl_group = 'Желтая зона' and (cm_adm.num like '1.1%' or cm_adm.num like '7.2%' or cm_adm.num like '7.3%' or cm_adm.num like '10.2%')) group by a.u7m_id;
15;Проверка критериев проблемности по не кредитующимся контрагентам;Заемщик (ЮЛ) Поручители (ЮЛ, ИП);PRNCR;;CLU;Постнова Мария;1;CLU_CHECK;select clu.u7m_id, 'PRNCR', 1 as check_lvl, chk.prncr_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_039 chk on clu.crm_id = chk.crm_id ; select clu.u7m_id, 'PRNCR', 1 as check_lvl, chk.prncr_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_039 chk on clu.crm_id = chk.crm_id
;Проверка непустой ссылки на досье ЕСМ;Заемщик (ЮЛ) Поручители (ЮЛ);RUID_CHECK;;CLU;Амелин Сергей;1;CLU_CHECK; SELECT a.U7M_ID, 'RUID_CHECK' as check_name, 1 as check_lvl, CASE WHEN COALESCE(a.RU_ID, '') = '' THEN 1 ELSE 0 END as check_flg from {{schema_k7m_pa}}.clu a ; SELECT a.U7M_ID, 'RUID_CHECK' as check_name, 1 as check_lvl, CASE WHEN COALESCE(a.RU_ID, '') = '' THEN 1 ELSE 0 END as check_flg from custom_cb_k7m.clu a
3;Санкционные списки по юридическим лицам (в т.ч. проверка поручителей);Заемщик (ЮЛ) Поручители (ЮЛ, ИП);SANCT;;CLU;Кузнецов Максим;1;CLU_CHECK;select clu.u7m_id, 'SANCT', 1 as check_lvl, case when r.crm_id is not null then 1 when r.crm_id is null then 0 end as check_flg from {{schema_k7m_pa}}.clu clu left join internal_rdm.rdm_compliance_k7m_mast_v r on clu.crm_id = r.crm_id;select clu.u7m_id, 'SANCT', 1 as check_lvl, case when r.crm_id is not null then 1 when r.crm_id is null then 0 end as check_flg from {{schema_k7m_pa}}.clu clu left join internal_rdm.rdm_compliance_k7m_mast_v r on clu.crm_id = r.crm_id
5;Террористы (ПОД/ФТ) (запрет дебета расчетного счета);Заемщик (ЮЛ) Поручители (ЮЛ, ИП);TERROR;;CLU;Постнова Мария;1;CLU_CHECK;select clu.u7m_id, 'TERROR', 1 as check_lvl, chk.terror_flg from {{schema_k7m_pa}}.clu clu inner join {{schema_k7m_stg}}.ods_t_check_010 chk on clu.eks_id = cast(chk.eks_id as string) ;
;Проверка на наличие у заемщика хотя бы одного BO c прикрепленным SET;Заемщик (ЮЛ);BO_EXIST;;SCORE;Спирин Артем;2;SCORE_CHECK;SELECT a.U7M_ID, 'BO_EXIST' as check_name, 2 as check_lvl, 1 as check_flg from {{schema_k7m_pa}}.score_keys a left join (select distinct u7m_id from {{schema_k7m_pa}}.bo) b on a.U7M_ID = b.U7M_ID where b.u7m_id is null;
;Проверка на Cindex_ST;Заемщик (ЮЛ);CINDEX_ST;;CLU{FLAG_BASIS_CLIENT = 'Y'};Спирин Артем;2;SCORE_CHECK; SELECT a.U7M_ID, 'CINDEX_ST' as check_name, 2 as check_lvl, 1 as check_flg from {{schema_k7m_pa}}.clu a join {{schema_k7m_pa}}.score b on a.u7m_id = b.u7m_id and b.key = 'CINDEX_ST' where a.flag_basis_client = 'Y' and b.value_n = 23.0 ;
;Вычисление общего флага для фильтрации на основе всех проверок;Заемщик (ЮЛ) Поручители (ЮЛ, ИП, ФЛ);GEN_OFFLINE_CHECK;ALL_2;CLU;Спирин Артем;2;CLU_CHECK;SELECT a.U7M_ID, 'GEN_OFFLINE_CHECK' as check_name, 2 as check_lvl, max(case when a.check_flg = 1 then 1 else 0 end) as check_flg from {{schema_k7m_pa}}.clu_check a where a.check_lvl <= 2 group by a.U7M_ID;
;Вычисление общего флага для фильтрации на основе всех проверок SCORE;Заемщик (ЮЛ);GEN_OFFLINE_CHECK;ALL_2;SCORE;Спирин Артем;2;SCORE_CHECK;SELECT a.U7M_ID, 'GEN_OFFLINE_CHECK' as check_name, 2 as check_lvl,max(case when a.check_flg = 1 then 1 else 0 end) as check_flg from {{schema_k7m_pa}}.score_check a where a.check_lvl <= 2 group by a.U7M_ID;
;Проверка на интегральный рейтинг;Заемщик (ЮЛ);RATING_INT;;CLU{FLAG_BASIS_CLIENT = 'Y'};Спирин Артем;2;SCORE_CHECK;select a.U7M_ID, 'RATING_INT' as check_name, 2 as check_lvl, 1 as check_flg from {{schema_k7m_pa}}.clu a join {{schema_k7m_pa}}.pdout b on a.U7M_ID = b.U7M_ID and coalesce(b.rating_offline, 999) > 18 where a.flag_basis_client = 'Y' ;
23;Риск-сегмент;Заемщик (ЮЛ);RS;;CLU{FLAG_BASIS_CLIENT = 'Y'};Спирин Артем;2;SCORE_CHECK; SELECT a.U7M_ID, 'RS' as check_name, 2 as check_lvl, 1 as check_flg from {{schema_k7m_pa}}.clu a join {{schema_k7m_aux}}.proxyrs_int_final b on a.U7M_ID = b.U7M_ID and b.k7m_flag = 0 where a.flag_basis_client = 'Y' ; SELECT a.U7M_ID, 'RS' as check_name, 2 as check_lvl, 1 as check_flg from {{schema_k7m_pa}}.clu a join {{schema_k7m_pa}}_aux.proxyrs_int_final b on a.U7M_ID = b.U7M_ID and b.k7m_flag = 0 where a.flag_basis_client = 'Y'
;Проверка на расчет обязательных параметров SCORE;Заемщик (ЮЛ);SCORE_CHECK;;SCORE;Спирин Артем;2;SCORE_CHECK;SELECT k.U7M_ID, concat(k.block_nm,':',k.key) as check_name, 2 as check_lvl, 1 as check_flg, k.exec_id from ( select a.u7m_id, b.key, b.block_nm, a.exec_id from {{schema_k7m_pa}}.score_keys a cross join {{schema_k7m_aux}}.dict_mandatory_keys_out b where b.obj = 'SCORE' ) k left join {{schema_k7m_pa}}.score c on c.u7m_id = k.u7m_id and c.key = k.key where c.value_n is null and c.value_c is null and c.value_d is null;SELECT k.U7M_ID, concat(k.block_nm,':',k.key) as check_name, 2 as check_lvl, 1 as check_flg, k.exec_id from ( select a.u7m_id, b.key, b.block_nm, a.exec_id from {{schema_k7m_pa}}.score_keys a cross join {{schema_k7m_pa}}_aux.dict_mandatory_keys_out b where b.obj = 'SCORE' ) k left join {{schema_k7m_pa}}.score c on c.u7m_id = k.u7m_id and c.key = k.key where c.value_n is null and c.value_c is null and c.value_d is null
;Проверка на расчет СКЕ;Заемщик (ЮЛ);SKE;;CLU{FLAG_BASIS_CLIENT = 'Y'};Спирин Артем;2;CLU_CHECK; SELECT a.U7M_ID, 'SKE' as check_name, 2 as check_lvl, 1 as check_flg from {{schema_k7m_pa}}.clu a join {{schema_k7m_pa}}.limitout b on a.u7m_id = b.u7m_id where a.flag_basis_client = 'Y' and (coalesce(b.ske_base, 0) <= 0 or b.ske_d_0 is NULL);
36;Анализ заключения Робота-юриста в части итогового решения;Заемщик (ЮЛ) Поручители (ЮЛ, ИП);CORCLEIO;;CLU;Амелин Сергей;3;CLU_CHECK;SELECT a.U7M_ID, 'CORCLEIO' as check_name, 3 as check_lvl, CASE WHEN a.OFFLINE_RU_MARK in ('1','3','4') THEN 0 ELSE 1 END as check_flg from {{schema_k7m_pa}}.clu a inner join {{schema_k7m_aux}}.vdrlout_clu_104 b on a.u7m_id = b.crm_id;
;Вычисление флага заемщика по ответу ММЗ;Заемщик (ЮЛ);MMZDEBTOR;;SCORE;Спирин Артем;3;SCORE_CHECK;select a.u7m_id, 'MMZDEBTOR' as check_name, 3 as check_lvl, 1 as check_flg from {{schema_k7m_pa}}.score_keys a left join {{schema_k7m_pa}}.mmz_clu mmz on (a.u7m_id = mmz.u7m_id) left join {{schema_k7m_aux}}.mmz_clu_by_clf b on (a.u7m_id = b.u7m_id) left join {{schema_k7m_aux}}.mmz_clu_by_participant c on (a.u7m_id = c.u7m_id) where b.mmz_zone in (0, 1) or c.mmz_zone in (0, 1) or mmz.borrower_zone in (0, 1);
;Вычисление флага поручителя по ответу ММЗ;Поручители (ЮЛ, ИП, ФЛ);MMZGUAR;;CLU;Спирин Артем;3;CLU_CHECK;select a.u7m_id, 'MMZGUAR' as check_name, 3 as check_lvl, 1 as check_flg from {{schema_k7m_pa}}.clu a join {{schema_k7m_pa}}.set_item si on (a.u7m_id = si.7m_id and si.obj = 'CLU') left join {{schema_k7m_pa}}.mmz_clu mmz on (a.u7m_id = mmz.u7m_id) left join {{schema_k7m_aux}}.mmz_clu_by_clf b on (a.u7m_id = b.u7m_id) where b.mmz_zone in (0, 1) or mmz.guarantor_zone in (0, 1);
;Вычисление общего флага для фильтрации на основе всех проверок;Заемщик (ЮЛ) Поручители (ЮЛ, ИП, ФЛ);GEN_TOTAL_CHECK;ALL_3;CLU;Спирин Артем;3;CLU_CHECK;SELECT a.U7M_ID, 'GEN_TOTAL_CHECK' as check_name, 3 as check_lvl, max(case when a.check_flg = 1 then 1 else 0 end) as check_flg from {{schema_k7m_pa}}.clu_check a where a.check_lvl <= 3 group by a.U7M_ID;
;Вычисление общего флага для фильтрации на основе всех проверок;Заемщик (ЮЛ) Поручители (ЮЛ, ИП, ФЛ);GEN_TOTAL_CHECK;ALL_3;SCORE;Спирин Артем;3;SCORE_CHECK;SELECT a.U7M_ID, 'GEN_TOTAL_CHECK' as check_name, 3 as check_lvl, max(case when a.check_flg = 1 then 1 else 0 end) as check_flg from {{schema_k7m_pa}}.score_check a where a.check_lvl <= 3 group by a.U7M_ID;
КОД;Фактический адрес: индекс;Заемщик (ЮЛ) Поручители (ЮЛ);COD_F_ADDRESS_postalCode;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_F_ADDRESS_postalCode' as check_name,1 as check_lvl,case when CLU.F_ADDRESS_postalCode rlike '^[0-9]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;select CLU.u7m_id,'COD_F_ADDRESS_postalCode' as check_name,1 as check_lvl,case when CLU.F_ADDRESS_postalCode rlike '^[0-9]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU
КОД;Фактический адрес: регион;Заемщик (ЮЛ) Поручители (ЮЛ);COD_F_ADDRESS_regionName;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_F_ADDRESS_regionName' as check_name,1 as check_lvl,case when nvl(CLU.F_ADDRESS_regionName, ' ') rlike '^[-А-ЯЁа-яё0-9 /\".]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Фактический адрес: район;Заемщик (ЮЛ) Поручители (ЮЛ);COD_F_ADDRESS_districtName;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_F_ADDRESS_districtName' as check_name,1 as check_lvl,case when nvl(CLU.F_ADDRESS_districtName, ' ') rlike '^[-А-ЯЁа-яё0-9 /\".]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Фактический адрес: город населенный пункт;Заемщик (ЮЛ) Поручители (ЮЛ);COD_F_ADDRESS_cityNamevillageName;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_F_ADDRESS_cityNamevillageName' as check_name,1 as check_lvl,case when (CLU.F_ADDRESS_cityName rlike '^[А-ЯЁа-яё0-9 /\".]+$'or CLU.F_ADDRESS_regionName in ('ГОРОД МОСКВА','ГОРОД САНКТ-ПЕТЕРБУРГ') or CLU.F_ADDRESS_villageName rlike '^[А-ЯЁа-яё0-9 /\".]+$') then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;select CLU.u7m_id,'COD_F_ADDRESS_cityNamevillageName' as check_name,1 as check_lvl,case when (CLU.F_ADDRESS_cityName rlike '^[А-ЯЁа-яё0-9 /\".]+$'or CLU.F_ADDRESS_regionName in ('ГОРОД МОСКВА','ГОРОД САНКТ-ПЕТЕРБУРГ') or CLU.F_ADDRESS_villageName rlike '^[А-ЯЁа-яё0-9 /\".]+$') then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU
КОД;Фактический адрес: сокр наименование населенного пункта;Заемщик (ЮЛ) Поручители (ЮЛ);COD_F_ADDRESS_shortVillageTypeName;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_F_ADDRESS_shortVillageTypeName' as check_name,1 as check_lvl,case when (CLU.F_ADDRESS_villageName is null or CLU.F_ADDRESS_regionName in ('ГОРОД МОСКВА','ГОРОД САНКТ-ПЕТЕРБУРГ') or ( CLU.F_ADDRESS_villageName is not null and CLU.F_ADDRESS_shortVillageTypeName rlike '^[А-ЯЁа-яё0-9 /\".]+$')) then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Фактический адрес: улица;Заемщик (ЮЛ) Поручители (ЮЛ);COD_F_ADDRESS_streetName;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_F_ADDRESS_streetName' as check_name,1 as check_lvl,case when CLU.F_ADDRESS_streetName rlike '^[А-ЯЁа-яё0-9 /\"-.]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Фактический адрес: сокр наименование улицы;Заемщик (ЮЛ) Поручители (ЮЛ);COD_F_ADDRESS_shortStreetTypeName;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id, 'COD_F_ADDRESS_shortStreetTypeName' as check_name,1 as check_lvl,case when CLU.F_ADDRESS_shortStreetTypeName rlike '^[А-ЯЁа-яё0-9 /\".-]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Фактический адрес: номер дома;Заемщик (ЮЛ) Поручители (ЮЛ);COD_F_ADDRESS_houseNumber;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_F_ADDRESS_houseNumber' as check_name,1 as check_lvl,case when nvl(CLU.F_ADDRESS_houseNumber,' ') rlike '^[А-ЯЁа-яё0-9 /\"-.]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Фактический адрес: номер корпуса;Заемщик (ЮЛ) Поручители (ЮЛ);COD_F_ADDRESS_buildingNumber;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_F_ADDRESS_buildingNumber' as check_name,1 as check_lvl,case when nvl(CLU.F_ADDRESS_buildingNumber,' ') rlike '^[А-ЯЁа-яё0-9 /\"-.]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Фактический адрес: номер строения;Заемщик (ЮЛ) Поручители (ЮЛ);COD_F_ADDRESS_blockNumber;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_F_ADDRESS_blockNumber' as check_name,1 as check_lvl,case when nvl(CLU.F_ADDRESS_blockNumber,' ') rlike '^[А-ЯЁа-яё0-9 /\"-.]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Фактический адрес: номер квартиры;Заемщик (ЮЛ) Поручители (ЮЛ);COD_F_ADDRESS_flatNumber;;CLU;Амелин Сергей;-1;CLU_CHECK;select CLU.u7m_id,'COD_F_ADDRESS_flatNumber' as check_name,1 as check_lvl,case when nvl(CLU.F_ADDRESS_flatNumber,' ') rlike '^[А-ЯЁа-яё0-9 /\"-.]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Адрес регистрации: индекс;Заемщик (ЮЛ) Поручители (ЮЛ);COD_REG_ADDRESS_postalCode;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_REG_ADDRESS_postalCode' as check_name,1 as check_lvl,case when CLU.Reg_ADDRESS_postalCode rlike '^[0-9]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Адрес регистрации: регион;Заемщик (ЮЛ) Поручители (ЮЛ);COD_REG_ADDRESS_regionName;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_REG_ADDRESS_regionName' as check_name,1 as check_lvl,case when nvl(CLU.Reg_ADDRESS_regionName, ' ') rlike '^[А-ЯЁа-яё0-9 /\"-.]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Адрес регистрации: район;Заемщик (ЮЛ) Поручители (ЮЛ);COD_REG_ADDRESS_districtName;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_REG_ADDRESS_districtName' as check_name,1 as check_lvl,case when nvl(CLU.Reg_ADDRESS_districtName, ' ') rlike '^[А-ЯЁа-яё0-9 /\"-.]+$' then 0 when CLU.Reg_ADDRESS_districtName = '%' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Адрес регистрации: город населенный пункт;Заемщик (ЮЛ) Поручители (ЮЛ);COD_REG_ADDRESS_cityNamevillageName;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_REG_ADDRESS_cityNamevillageName' as check_name,1 as check_lvl,case when (CLU.Reg_ADDRESS_cityName rlike '^[А-ЯЁа-яё0-9 /\".-]+$' or CLU.Reg_ADDRESS_regionName in ('ГОРОД МОСКВА','ГОРОД САНКТ-ПЕТЕРБУРГ') or CLU.Reg_ADDRESS_villageName rlike '^[А-ЯЁа-яё0-9 /\".]+$' or (REG_ADDRESS_cityName = '%' and REG_ADDRESS_villageName = '%')) then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Адрес регистрации: сокр наименование населенного пункта;Заемщик (ЮЛ) Поручители (ЮЛ);COD_REG_ADDRESS_shortVillageTypeName;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_REG_ADDRESS_shortVillageTypeName' as check_name,1 as check_lvl,case when (CLU.Reg_ADDRESS_villageName is null or CLU.Reg_ADDRESS_regionName in ('ГОРОД МОСКВА','ГОРОД САНКТ-ПЕТЕРБУРГ') or ( CLU.Reg_ADDRESS_villageName is not null and CLU.Reg_ADDRESS_shortVillageTypeName rlike '^[А-ЯЁа-яё0-9 /\".-]+$') or (REG_ADDRESS_cityName = '%' and REG_ADDRESS_villageName = '%') ) then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Адрес регистрации: улица;Заемщик (ЮЛ) Поручители (ЮЛ);COD_REG_ADDRESS_streetName;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_REG_ADDRESS_streetName' as check_name,1 as check_lvl,case when CLU.Reg_ADDRESS_streetName rlike '^[А-ЯЁа-яё0-9 /\".-]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Адрес регистрации: сокр наименование улицы;Заемщик (ЮЛ) Поручители (ЮЛ);COD_REG_ADDRESS_shortStreetTypeName;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id, 'COD_REG_ADDRESS_shortStreetTypeName' as check_name,1 as check_lvl,case when CLU.Reg_ADDRESS_shortStreetTypeName rlike '^[А-ЯЁа-яё0-9 /\".]+$'  or Reg_ADDRESS_shortStreetTypeName = '%' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Адрес регистрации: номер дома;Заемщик (ЮЛ) Поручители (ЮЛ);COD_REG_ADDRESS_houseNumber;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_REG_ADDRESS_houseNumber' as check_name,1 as check_lvl,case when nvl(CLU.Reg_ADDRESS_houseNumber,' ') rlike '^[А-ЯЁа-яё0-9 /\"-.]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Адрес регистрации: номер корпуса;Заемщик (ЮЛ) Поручители (ЮЛ);COD_REG_ADDRESS_buildingNumber;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_REG_ADDRESS_buildingNumber' as check_name,1 as check_lvl,case when nvl(CLU.Reg_ADDRESS_buildingNumber,' ') rlike '^[А-ЯЁа-яё0-9 /\"-.]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Адрес регистрации: номер строения;Заемщик (ЮЛ) Поручители (ЮЛ);COD_REG_ADDRESS_blockNumber;;CLU;Амелин Сергей;1;CLU_CHECK;select CLU.u7m_id,'COD_REG_ADDRESS_blockNumber' as check_name,1 as check_lvl,case when nvl(CLU.Reg_ADDRESS_blockNumber,' ') rlike '^[А-ЯЁа-яё0-9 /\"-.]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
КОД;Адрес регистрации: номер квартиры;Заемщик (ЮЛ) Поручители (ЮЛ);COD_REG_ADDRESS_flatNumber;;CLU;Амелин Сергей;-1;CLU_CHECK;select CLU.u7m_id,'COD_REG_ADDRESS_flatNumber' as check_name,1 as check_lvl,case when nvl(CLU.Reg_ADDRESS_flatNumber,' ') rlike '^[А-ЯЁа-яё0-9 /\"-.]+$' then 0 else 1 end as check_flg from {{schema_k7m_pa}}.CLU;
24;Картотека счета и арест/блокировка счета (возможны по требованию Налоговой службы, ФССП или по решению суда);Заемщик (ЮЛ) Поручители (ЮЛ, ИП);CARTT;;CLF;Постнова Мария;1;CLF_CHECK;select clf.f7m_id, 'CARTT', 1 as check_lvl, chk.cartt_flg from {{schema_k7m_pa}}.clf clf inner join {{schema_k7m_aux}}.clf_keys k on  clf.f7m_id = k.f7m_id inner join (select concat('EK_',ei.loc_id) as loc_id, id as eks_id from {{schema_k7m_aux}}.k7m_eks_eiogen ei union all select concat('EХ_',ex.loc_id) as loc_id, from_eks_id as eks_id from {{schema_k7m_aux}}.exsgen ex ) loc on loc.loc_id = k.link_id inner join {{schema_k7m_stg}}.ods_t_check_010 chk on loc.eks_id = chk.eks_id; select clf.f7m_id, 'CARTT', 1 as check_lvl, chk.cartt_flg from {{schema_k7m_pa}}.clf clf inner join {{schema_k7m_aux}}.clf_keys k on  clf.f7m_id = k.f7m_id inner join (select concat('EK_',ei.loc_id) as loc_id, id as eks_id from {{schema_k7m_aux}}.k7m_eks_eiogen ei union all select concat('EХ_',ex.loc_id) as loc_id, from_eks_id as eks_id from {{schema_k7m_aux}}.exsgen ex ) loc on loc.loc_id = k.link_id inner join {{schema_k7m_stg}}.ods_t_check_010 chk on loc.eks_id = chk.eks_id
28;Внутренняя кредитная история по юридическим и физическим лицам;Заемщик (ЮЛ) Поручители (ЮЛ, ИП);INTCRH;;CLF;Постнова Мария;1;CLF_CHECK; select clf.f7m_id, 'INTCRH', 1 as check_lvl, chk.intcrh_flg from {{schema_k7m_pa}}.clf clf inner join {{schema_k7m_aux}}.clf_keys k on  clf.f7m_id = k.f7m_id inner join (select concat('EK_',ei.loc_id) as loc_id, id as eks_id from {{schema_k7m_aux}}.k7m_eks_eiogen ei union all select concat('EХ_',ex.loc_id) as loc_id, from_eks_id as eks_id from {{schema_k7m_aux}}.exsgen ex ) loc on loc.loc_id = k.link_id inner join {{schema_k7m_stg}}.ods_t_check_010 chk on loc.eks_id = chk.eks_id ; select clf.f7m_id, 'INTCRH', 1 as check_lvl, chk.intcrh_flg from {{schema_k7m_pa}}.clf clf inner join {{schema_k7m_aux}}.clf_keys k on  clf.f7m_id = k.f7m_id inner join (select concat('EK_',ei.loc_id) as loc_id, id as eks_id from {{schema_k7m_aux}}.k7m_eks_eiogen ei union all select concat('EХ_',ex.loc_id) as loc_id, from_eks_id as eks_id from {{schema_k7m_aux}}.exsgen ex ) loc on loc.loc_id = k.link_id inner join {{schema_k7m_stg}}.ods_t_check_010 chk on loc.eks_id = chk.eks_id
14;Проверка критериев проблемности по кредитующимся контрагентам;Заемщик (ЮЛ) Поручители (ЮЛ, ИП);PRCR;;CLF;Постнова Мария;1;CLF_CHECK;select clf.f7m_id, 'PRCR', 1 as check_lvl, chk.prcr_flg from custom_cb_k7m.clf clf inner join custom_cb_k7m_stg.ods_t_check_039 chk on clf.crm_id = chk.crm_id ; select clf.f7m_id, 'PRCR', 1 as check_lvl, chk.prcr_flg from custom_cb_k7m.clf clf inner join custom_cb_k7m_stg.ods_t_check_039 chk on clf.crm_id = chk.crm_id
15;Проверка критериев проблемности по не кредитующимся контрагентам;Заемщик (ЮЛ) Поручители (ЮЛ, ИП);PRNCR;;CLF;Постнова Мария;1;CLF_CHECK;select clf.f7m_id, 'PRNCR', 1 as check_lvl, chk.prncr_flg from custom_cb_k7m.clf clf inner join custom_cb_k7m_stg.ods_t_check_039 chk on clf.crm_id = chk.crm_id ; select clf.f7m_id, 'PRNCR', 1 as check_lvl, chk.prncr_flg from custom_cb_k7m.clf clf inner join custom_cb_k7m_stg.ods_t_check_039 chk on clf.crm_id = chk.crm_id
5;Террористы (ПОД/ФТ) (запрет дебета расчетного счета);Заемщик (ЮЛ) Поручители (ЮЛ, ИП);TERROR;;CLF;Постнова Мария;1;CLF_CHECK;select clf.f7m_id, 'TERROR', 1 as check_lvl, chk.terror_flg from {{schema_k7m_pa}}.clf clf inner join {{schema_k7m_aux}}.clf_keys k on  clf.f7m_id = k.f7m_id inner join (select concat('EK_',ei.loc_id) as loc_id, id as eks_id from {{schema_k7m_aux}}.k7m_eks_eiogen ei union all select concat('EХ_',ex.loc_id) as loc_id, from_eks_id as eks_id from {{schema_k7m_aux}}.exsgen ex ) loc on loc.loc_id = k.link_id inner join {{schema_k7m_stg}}.ods_t_check_010 chk on loc.eks_id = chk.eks_id ; select clf.f7m_id, 'TERROR', 1 as check_lvl, chk.terror_flg from {{schema_k7m_pa}}.clf clf inner join {{schema_k7m_aux}}.clf_keys k on  clf.f7m_id = k.f7m_id inner join (select concat('EK_',ei.loc_id) as loc_id, id as eks_id from {{schema_k7m_aux}}.k7m_eks_eiogen ei union all select concat('EХ_',ex.loc_id) as loc_id, from_eks_id as eks_id from {{schema_k7m_aux}}.exsgen ex ) loc on loc.loc_id = k.link_id inner join {{schema_k7m_stg}}.ods_t_check_010 chk on loc.eks_id = chk.eks_id
3;Санкционные списки по юридическим лицам (в т.ч. проверка поручителей);Заемщик (ЮЛ) Поручители (ЮЛ, ИП);SANCT_CRM;;CLU;Кузнецов Максим;1;CLU_CHECK;select clu.u7m_id, 'SANCT_CRM', 1 as check_lvl, case when l.row_id is not null then 1 when l.row_id is null then 0 end as check_flg from {{schema_k7m_pa}}.clu clu left join {{schema_k7m_stg}}.crm_cx_sanct_lst l on clu.crm_id = l.row_id;select clu.u7m_id, 'SANCT_CRM', 1 as check_lvl, case when l.row_id is not null then 1 when l.row_id is null then 0 end as check_flg from {{schema_k7m_pa}}.clu clu left join {{schema_k7m_stg}}.crm_cx_sanct_lst l on clu.crm_id = l.row_id;
3;Санкционные списки по юридическим лицам (в т.ч. проверка поручителей);Заемщик (ЮЛ) Поручители (ЮЛ, ИП);SANCT;;CLF;Кузнецов Максим;1;CLF_CHECK;select clf.f7m_id, 'SANCT', 1 as check_lvl, case when r.crm_id is not null then 1 when r.crm_id is null then 0 end as check_flg from {{schema_k7m_pa}}.clf clf left join internal_rdm.rdm_compliance_k7m_mast_v r on clf.crm_id = r.crm_id;select clf.f7m_id, 'SANCT', 1 as check_lvl, case when r.crm_id is not null then 1 when r.crm_id is null then 0 end as check_flg from {{schema_k7m_pa}}.clf clf left join internal_rdm.rdm_compliance_k7m_mast_v r on clf.crm_id = r.crm_id
3;Санкционные списки по юридическим лицам (в т.ч. проверка поручителей);Заемщик (ЮЛ) Поручители (ЮЛ, ИП);SANCT_CRM;;CLU;Кузнецов Максим;1;CLF_CHECK;select clf.f7m_id, 'SANCT_CRM', 1 as check_lvl, case when l.row_id is not null then 1 when l.row_id is null then 0 end as check_flg from {{schema_k7m_pa}}.clf clf left join {{schema_k7m_stg}}.crm_cx_sanct_lst l on clf.crm_id = l.row_id;select clf.f7m_id, 'SANCT_CRM', 1 as check_lvl, case when l.row_id is not null then 1 when l.row_id is null then 0 end as check_flg from {{schema_k7m_pa}}.clf clf left join {{schema_k7m_stg}}.crm_cx_sanct_lst l on clf.crm_id = l.row_